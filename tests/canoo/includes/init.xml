<?xml version="1.0"?>
<project name="Init Openads Web Tests" basedir=".." default="main">
  <property file="properties/user.properties"/>
  <property name="run.remote" value="false"/>

  <import file="${basedir}/../../build-canoo.xml"/>
    
  <taskdef resource="net/sf/antcontrib/antcontrib.properties"/>
  
  <taskdef name="sshexec" classname="org.apache.tools.ant.taskdefs.optional.ssh.SSHExec">
      <classpath>
        <pathelement location="${basedir}/lib/ant-jsch.jar" />
      </classpath>
  </taskdef>  
  
  <taskdef name="sqlunit" classname="net.sourceforge.sqlunit.ant.SqlunitTask">
      <classpath>
        <pathelement location="lib/sqlunit-5.0.jar" />
      </classpath>
  </taskdef>
  
  <macrodef name="clean-delivery-cache-local">
    <sequential>
      <delete>
        <fileset dir="./../../var/cache/">
          <include name="deliverycache_*" />
          <include name="cache_*" />
        </fileset>
      </delete>
    </sequential>
  </macrodef>

    <macrodef name="clean-delivery-cache">
      <sequential>
        <if>
          <istrue value="${run.remote}"/>
          <then>
            <clean-delivery-cache-remote/>
          </then>
          <else>
            <clean-delivery-cache-local/>
          </else>
        </if>
      </sequential>
    </macrodef>

    <target name="test-cache">
        <clean-delivery-cache />
        <!-- first run the test without delivery cache -->
        <antcall target="canoo-test" />
        <!-- then run it again using previously generated cache -->
        <antcall target="canoo-test" />
    </target>

</project>
