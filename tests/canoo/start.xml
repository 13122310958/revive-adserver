<?xml version="1.0"?>

  <!-- TODO:
             * add a check to ensure that returned HTML is a valid XHTML
  -->
<project name="delivery" basedir="." default="main">

  <import file="includes/init.xml"/>
  
  <property name="openads.path" value="${basedir}/../.."/>
  <property name="openads.url" value="${protocol}://${host}${basepath}"/>
  <property name="openads.example_url" value="${openads.url}/example.php"/>

  <target name="www-admin">
    <ant antfile="usecases/loginTest.xml" />
  </target>

  <target name="init-delivery-db">
    <sql
        driver="com.mysql.jdbc.Driver"
        url="${sql.url}"
        userid="${sql.user}"
        password="${sql.password}"
        >
      <transaction src="sql/dropTables.sql" />
      <transaction src="sql/delivery.sql" />
      <classpath>
        <fileset dir="lib">
          <include name="**/*.jar"/>
        </fileset>
      </classpath>
      <transaction>
        UPDATE oa_banners SET url = "${openads.example_url}" WHERE url = "http://www.example.com"
      </transaction>
    </sql>
  </target>
  
  <target name="init-delivery-files">
    <copy file="php/example.php" todir="${openads.path}/www" />
  </target>
  
  <target name="init-delivery" depends="init-delivery-db, init-delivery-files" />
  
  <target name="delivery">
    <ant antfile="usecases/delivery/ac.xml" />
    <ant antfile="usecases/delivery/afr.xml" />
    <ant antfile="usecases/delivery/ag.xml" />
    <ant antfile="usecases/delivery/ai.xml" />
    <ant antfile="usecases/delivery/ajs.xml" />
    <ant antfile="usecases/delivery/al.xml" />
    <ant antfile="usecases/delivery/alocal.xml" />
    <!-- <ant antfile="usecases/delivery/apu.xml" /> -->
    <ant antfile="usecases/delivery/avw.xml" />
    <ant antfile="usecases/delivery/axmlrpc.xml" />
    <ant antfile="usecases/delivery/ck.xml" />
    <ant antfile="usecases/delivery/lg.xml" />
  </target>
  
  <target name="testing" depends="clean, init-delivery-db">
    <ant antfile="usecases/delivery/apu.xml" />
  </target>
  
  <target name="clean">
    <delete dir="target" />
  </target>
  
  <target name="main" depends="clean, init-delivery, delivery" />
  
</project>
