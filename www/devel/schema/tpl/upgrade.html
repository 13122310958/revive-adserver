<html>
<head>
    <title>Openads DB Upgrade</title>
    <link rel="stylesheet" type="text/css" href="css/upgrade.css"/>
</head>
<body>
<?php
if ($welcome)
{
?>
<div class="tablediv">
    <h2>Openads Database Upgrade Demonstration</h2>
    <form name="frmUpgrade" method="POST" action="upgrade.php">
        <!--button name="btn_initialise">hey! i see you need an upgrade, would you like me to help you with that?</button-->
        <button name="btn_view_available">view a list of available database upgrades</button>
        <button name="btn_view_logs">view a list of database upgrade log files</button>
        <button name="btn_view_audit">view the database upgrade audit trail</button>
    </form>
</div>
<?php
}
if ($backup)
{
?>
<div class="tablediv">
    <form name="frmUpgrade" method="POST" action="upgrade.php">
        <button name="btn_backup">i guess you should backup your database, yeah?</button>
    </form>
</div>
<?php
}
if (count($oUpgrade->aErrors)>0)
{
?>
<div class="tablediv" style="background-color:pink;">
    <?php
        foreach ($oUpgrade->aErrors AS $k => $err)
        {
            echo $err.'<br />';
        }
    ?>
</div>
<?php
}
if (count($oUpgrade->aMessages)>0)
{
?>
<div class="tablediv">
    <?php
        foreach ($oUpgrade->aMessages AS $k => $msg)
        {
            echo $msg.'<br />';
        }
    ?>
</div>
<?php
}
if (count($aLogfiles)>0)
{
?>
<div class="tablediv">
    <form name="frmUpgrade" method="POST" action="upgrade.php">
    <table class="tablemain">
    <tr>
        <th class="tableheader">upgrade log files in /var folder</th>
        <th class="tableheader">gwan</th>
    </tr>
    <?php
        foreach ($aLogfiles AS $k => $v)
        {
            echo "<tr>
                      <td class=\"tablebody\">{$v}</td>
                      <td class=\"tablebody\"><button name=\"btn_logfile\" value=\"{$v}\">have a gander</button></td>
                  </tr>";
        }
    ?>
    </table>
    </form>
</div>
<?php
}
if (count($aChangesetsAvail)>0)
{
?>
<div class="tablediv">
    <form name="frmUpgrade" method="POST" action="upgrade.php">
    <table class="tablemain">
    <tr><th class="tableheader" colspan="4">available schema changeset packages</th></tr>
    <tr><th class="tableheader">schema</th>
        <th class="tableheader">changeset</th>
        <th class="tableheader">migration class</th>
        <th class="tableheader">gwan</th>
    </tr>
    <?php
        foreach ($aChangesetsAvail AS $k => $v)
        {
            echo "<tr>
                      <td class=\"tablebody\">{$k}</td>
                      <td class=\"tablebody\">{$v['changeset']}</td>
                      <td class=\"tablebody\">{$v['migration']}</td>
                      <td class=\"tablebody\"><button name=\"btn_upgrade\" value=\"2\">upgrade me baby i dare ya!</button></td>
                  </tr>";
        }
    ?>
    </table>
    </form>
</div>
<?php
}
if (count($aAudit)>0)
{
?>
<div class="tablediv">
    <table class="tablemain">
    <tr><th class="tableheader" colspan="8">database action table</th></tr>
    <tr>
        <th class="tableheader">version</th>
        <th class="tableheader">timing</th>
        <th class="tableheader">action</th>
        <th class="tableheader">info1</th>
        <th class="tableheader">info2</th>
        <!--th class="tableheader">schema_backup</th-->
        <th class="tableheader">tablename</th>
        <th class="tableheader">tablename_backup</th>
        <th class="tableheader">updated</th>
    </tr>
    <?php
        foreach ($aAudit AS $k => $v)
        {
            $timing = ($v['timing'] ? 'destructive' : 'constructive');
            echo "<tr>
                      <td class=\"tablebody\">{$v['version']}</td>
                      <td class=\"tablebody\">{$timing}</td>
                      <td class=\"tablebody\">{$v['action']}</td>
                      <td class=\"tablebody\">{$v['info1']}</td>
                      <td class=\"tablebody\">{$v['info2']}</td>
                      <!--td class=\"tablebody\">{$v['schema_backup']}</td-->
                      <td class=\"tablebody\">{$v['tablename']}</td>
                      <td class=\"tablebody\">{$v['tablename_backup']}</td>
                      <td class=\"tablebody\">{$v['updated']}</td>
                  </tr>";
        }
    ?>
    </table>
</div>
<?php
}
if ($upgrade)
{
?>
<div class="tablediv" style="background-color:yellow;text-align:center;">
    <form name="frmUpgrade" method="POST" action="upgrade.php">
        <button name="btn_upgrade">upgrade me baby i dare ya!</button>
    </form>
</div>
<?php
}
if (isset($logcontent))
{
?>
<div class="tablediv">
    <table class="tablemain">
    <tr>
        <th class="tableheader"><?php echo $logfile; ?></th>
    </tr>
    <tr>
        <td><textarea cols="160" rows="160" ><?php echo $logcontent; ?></textarea></td>
    </tr>
    </table>
</div>
<?php
}
?>


</body>
</html>

